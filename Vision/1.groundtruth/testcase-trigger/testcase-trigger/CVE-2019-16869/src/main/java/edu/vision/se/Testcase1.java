package edu.vision.se;

import io.netty.buffer.Unpooled;
import io.netty.channel.embedded.EmbeddedChannel;
import io.netty.handler.codec.http.HttpRequest;
import io.netty.handler.codec.http.HttpRequestDecoder;
import io.netty.util.CharsetUtil;
import org.junit.Test;

import static org.junit.Assert.assertFalse;
import static org.junit.Assert.assertTrue;

public class Testcase1 {
    @Test(timeout = 60000)
    public void testWhitespace() {
        EmbeddedChannel channel = new EmbeddedChannel(new HttpRequestDecoder());
        String requestStr = "GET /some/path HTTP/1.1\r\n" +
                "Transfer-Encoding : chunked\r\n" +
                "Host: netty.io\n\r\n";
        channel.writeInbound(Unpooled.copiedBuffer(requestStr, CharsetUtil.US_ASCII));
        validateReturnValue(channel);
    }

    public void validateReturnValue(EmbeddedChannel channel) {
        HttpRequest request = channel.readInbound();
        assertTrue(request.decoderResult().isFailure());
        assertTrue(request.decoderResult().cause() instanceof IllegalArgumentException);
        assertFalse(channel.finish());
    }
}