package edu.vision.se;

import org.jasig.cas.client.validation.Cas10TicketValidator;
import org.junit.Test;
import static org.junit.Assert.*;

import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;

public class Testcase1 {
    protected static final String CONST_CAS_SERVER_URL_PREFIX = "http://localhost:";

    @Test
    public void urlEncodedValues() throws IllegalAccessException, IllegalArgumentException, InvocationTargetException,
            NoSuchMethodException, SecurityException {
        Cas10TicketValidator ticketValidator = new Cas10TicketValidator(CONST_CAS_SERVER_URL_PREFIX + "8090");
        final String ticket = "ST-1-owKEOtYJjg77iHcCQpkl-cas01.example.org%26%73%65%72%76%69%63%65%3d%68%74%74%70%25%33%41%25%32%46%25%32%46%31%32%37%2e%30%2e%30%2e%31%25%32%46%62%6f%72%69%6e%67%25%32%46%23";
        final String service = "foobar";
        Method constructValidationUrl_method = ticketValidator.getClass().getSuperclass().getSuperclass()
                .getDeclaredMethod("constructValidationUrl",
                        String.class, String.class);
        constructValidationUrl_method.setAccessible(true);

        Method encodeUrl_method = ticketValidator.getClass().getSuperclass().getSuperclass().getDeclaredMethod("encodeUrl", String.class);
        encodeUrl_method.setAccessible(true);

        final String url = (String) constructValidationUrl_method.invoke(ticketValidator, ticket, service);

        final String encodedValue = (String) encodeUrl_method.invoke(ticketValidator, ticket);
        assertTrue(url.contains(encodedValue));
        assertFalse(url.contains(ticket));
    }
}