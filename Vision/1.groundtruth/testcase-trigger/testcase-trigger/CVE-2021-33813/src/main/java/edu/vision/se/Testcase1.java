package edu.vision.se;

import static org.junit.Assert.assertFalse;
import static org.junit.Assert.assertNotNull;
import static org.junit.Assert.assertTrue;
import static org.junit.Assert.fail;

import org.jdom2.JDOMException;
import org.jdom2.input.SAXBuilder;
import org.jdom2.input.sax.SAXHandler;
import org.jdom2.input.sax.XMLReaderJDOMFactory;
import org.junit.Test;
import org.xml.sax.XMLReader;

public class Testcase1 {
    @Test
    public void testSetExternalFeature() {
        String feature = "http://xml.org/sax/features/external-general-entities";
        MySAXBuilder sb = new MySAXBuilder();
        try {
            sb.setFeature(feature, true);
            XMLReader reader = sb.createParser();
            assertNotNull(reader);
            assertTrue(reader.getFeature(feature));
            sb.setFeature(feature, false);
            reader = sb.createParser();
            assertNotNull(reader);
            assertFalse(reader.getFeature(feature));

        } catch (Exception e) {
            e.printStackTrace();
            fail("Could not create parser: " + e.getMessage());
        }
    }

    private class MySAXBuilder extends SAXBuilder {
        public MySAXBuilder() {
            super();
        }

        @SuppressWarnings("deprecation")
        public MySAXBuilder(String driver) {
            super(driver);
        }

        public MySAXBuilder(XMLReaderJDOMFactory fac) {
            super(fac);
        }

        /**
         * This sets and configures the parser (SAXBuilder just sets).
         */
        @Override
        public XMLReader createParser() throws JDOMException {
            XMLReader reader = super.createParser();
            configureParser(reader, new SAXHandler());
            return reader;
        }
    }
}