package edu.vision.se;

import org.junit.Test;
import org.springframework.mock.web.MockHttpServletRequest;
import org.springframework.security.web.firewall.DefaultHttpFirewall;
import org.springframework.security.web.firewall.RequestRejectedException;

public class Testcase1 {
    /**
     * On WebSphere 8.5 a URL like /context-root/a/b;%2f1/c can bypass a rule on
     * /a/b/c because the pathInfo is /a/b;/1/c which ends up being /a/b/1/c
     * while Spring MVC will strip the ; content from requestURI before the path
     * is URL decoded.
     */
    @Test(expected = RequestRejectedException.class)
    public void getFirewalledRequestWhenLowercaseEncodedPathThenException() {
        DefaultHttpFirewall fw = new DefaultHttpFirewall();
        MockHttpServletRequest request = new MockHttpServletRequest();
        request.setRequestURI("/context-root/a/b;%2f1/c");
        request.setContextPath("/context-root");
        request.setServletPath("");
        request.setPathInfo("/a/b;/1/c"); // URL decoded requestURI
        fw.getFirewalledRequest(request);
    }
}