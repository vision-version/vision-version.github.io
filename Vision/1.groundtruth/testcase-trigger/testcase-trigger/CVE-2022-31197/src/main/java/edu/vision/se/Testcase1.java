package edu.vision.se;

import org.junit.Test;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

import static org.junit.Assert.assertTrue;

public class Testcase1 extends BaseTest4 {
    @Test
    public void testWithDataColumnThatRequiresEscaping() throws Exception {
        TestUtil.dropTable(con, "refresh_row_bad_ident");
        TestUtil.execute(con, "CREATE TABLE refresh_row_bad_ident (id int PRIMARY KEY, \"1 FROM refresh_row_bad_ident; SELECT 2; SELECT *\" int)");
        TestUtil.execute(con, "INSERT INTO refresh_row_bad_ident (id) VALUES (1), (2), (3)");

        Statement stmt = con.createStatement(ResultSet.TYPE_FORWARD_ONLY, ResultSet.CONCUR_UPDATABLE);
        ResultSet rs = stmt.executeQuery("SELECT * FROM refresh_row_bad_ident");
        assertTrue(rs.next());
        try {
            rs.refreshRow();
        } catch (SQLException ex) {
            throw new RuntimeException("ResultSet.refreshRow() did not handle escaping data column identifiers", ex);
        }
        rs.close();
        stmt.close();
    }
}
