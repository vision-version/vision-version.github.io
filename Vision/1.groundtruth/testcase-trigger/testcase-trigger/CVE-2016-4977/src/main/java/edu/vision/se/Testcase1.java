package edu.vision.se;

import static org.junit.Assert.assertEquals;

import java.lang.reflect.Constructor;
import java.lang.reflect.Method;
import java.util.HashMap;
import java.util.Map;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.junit.jupiter.api.Test;
import org.springframework.mock.web.MockHttpServletRequest;
import org.springframework.mock.web.MockHttpServletResponse;

public class Testcase1 {
    private MockHttpServletResponse response = new MockHttpServletResponse();
    private MockHttpServletRequest request = new MockHttpServletRequest();

    @Test
    public void recursive() throws Exception {
        Class<?> clazz;
        try {
            clazz = Class.forName("org.springframework.security.oauth2.provider.endpoint.SpelView");
        } catch (ClassNotFoundException e) {
            return;
        }
        Constructor<?> constructor = clazz.getConstructor(String.class);
        constructor.setAccessible(true);
        Object view = constructor.newInstance("${${hit}}");
        Map<String, Object> map = new HashMap<String, Object>();
        map.put("hit", "me");
        map.put("me", "${ouch}");
        Method render_method = clazz.getMethod("render", Map.class, HttpServletRequest.class,
                HttpServletResponse.class);
        render_method.setAccessible(true);
        render_method.invoke(view, map, request, response);
        validateReturnValue(response.getContentAsString());
    }

    public void validateReturnValue(String result) {
        assertEquals("${ouch}", result);
    }
}