package org.springframework.data.rest.webmvc.json.patch;
import org.springframework.data.mapping.PropertyPath;
class AddOperation extends PatchOperation {
	 public AddOperation(String path, Object value) {
		super("add", path, value);
	}
	
	 @Override <T> void perform(Object targetObject, Class<T> type) {
		addValue(targetObject, evaluateValueFromTarget(targetObject, type));
	}
	
	 @Override
	protected <T> Object evaluateValueFromTarget(Object targetObject, Class<T> entityType) {
		if (!path.endsWith("-")) {
			return super.evaluateValueFromTarget(targetObject, entityType);
		}
		
		PropertyPath path = verifyPath(entityType);
		return evaluate(path == null ? entityType : path.getType());
	}
	
}

