diff --git a/./github_diff/CVE-2018-20227/oldfiles/ZipUtil.java b/./github_diff/CVE-2018-20227/newfiles/ZipUtil.java
index 616b6e4..9452c88 100644
--- a/./github_diff/CVE-2018-20227/oldfiles/ZipUtil.java
+++ b/./github_diff/CVE-2018-20227/newfiles/ZipUtil.java
@@ -34,10 +34,13 @@ public class ZipUtil {
 	
 	 public static void writeEntry(ZipFile zipFile, ZipEntry entry, File destDir) throws IOException {
 		File outFile = new File(destDir, entry.getName());
+		if (! outFile.getCanonicalFile().toPath().startsWith(destDir.toPath())) {
+			throw new IOException("Zip entry outside destination directory: " + entry.getName());
+		}
+		
 				 if (entry.isDirectory()) {
 			outFile.mkdirs();
 		}
-		
 		 else {
 			outFile.getParentFile().mkdirs();
 			try (InputStream in = zipFile.getInputStream(entry)) {
