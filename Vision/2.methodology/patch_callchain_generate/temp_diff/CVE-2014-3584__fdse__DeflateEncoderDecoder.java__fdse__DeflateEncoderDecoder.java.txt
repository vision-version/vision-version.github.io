diff --git a/./github_diff/CVE-2014-3584/oldfiles/DeflateEncoderDecoder.java b/./github_diff/CVE-2014-3584/newfiles/DeflateEncoderDecoder.java
index e5aa84f..52686a9 100644
--- a/./github_diff/CVE-2014-3584/oldfiles/DeflateEncoderDecoder.java
+++ b/./github_diff/CVE-2014-3584/newfiles/DeflateEncoderDecoder.java
@@ -16,6 +16,16 @@ public class DeflateEncoderDecoder {
         while (!inflater.finished()) {
             inputLen = inflater.inflate(input);
             if (!inflater.finished()) {
+                if (inputLen == 0) {
+                    if (inflater.needsInput()) {
+                        throw new DataFormatException("Inflater can not inflate all the token bytes");
+                    }
+                     else {
+                        break;
+                    }
+                    
+                }
+                
                 inflatedToken = new byte[input.length + inflatedLen];
                 System.arraycopy(input, 0, inflatedToken, inflatedLen, inputLen);
                 inflatedLen += inputLen;
@@ -35,7 +45,7 @@ public class DeflateEncoderDecoder {
         Deflater compresser = new Deflater(Deflater.DEFLATED, true);
         compresser.setInput(tokenBytes);
         compresser.finish();
-        byte[] output = new byte[tokenBytes.length];
+        byte[] output = new byte[tokenBytes.length * 2];
         int compressedDataLength = compresser.deflate(output);
         byte[] result = new byte[compressedDataLength];
         System.arraycopy(output, 0, result, 0, compressedDataLength);
