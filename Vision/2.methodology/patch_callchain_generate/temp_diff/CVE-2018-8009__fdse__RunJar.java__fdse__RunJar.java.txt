diff --git a/./github_diff/CVE-2018-8009/oldfiles/RunJar.java b/./github_diff/CVE-2018-8009/newfiles/RunJar.java
index 9128e74..b5c6272 100644
--- a/./github_diff/CVE-2018-8009/oldfiles/RunJar.java
+++ b/./github_diff/CVE-2018-8009/newfiles/RunJar.java
@@ -40,6 +40,7 @@ public class RunJar {
   public static void unJar(File jarFile, File toDir, Pattern unpackRegex) throws IOException {
     try (JarFile jar = new JarFile(jarFile)) {
       int numOfFailedLastModifiedSet = 0;
+      String targetDirPath = toDir.getCanonicalPath() + File.separator;
       Enumeration<JarEntry> entries = jar.entries();
       while (entries.hasMoreElements()) {
         final JarEntry entry = entries.nextElement();
@@ -47,6 +48,10 @@ public class RunJar {
           try (InputStream in = jar.getInputStream(entry)) {
             File file = new File(toDir, entry.getName());
             ensureDirectory(file.getParentFile());
+            if (!file.getCanonicalPath().startsWith(targetDirPath)) {
+              throw new IOException("expanding " + entry.getName() + " would create file outside of " + toDir);
+            }
+            
             try (OutputStream out = new FileOutputStream(file)) {
               IOUtils.copyBytes(in, out, BUFFER_SIZE);
             }
