diff --git a/./github_diff/CVE-2023-43642/oldfiles/SnappyOutputStream.java b/./github_diff/CVE-2023-43642/newfiles/SnappyOutputStream.java
index 9223831..b015eb9 100644
--- a/./github_diff/CVE-2023-43642/oldfiles/SnappyOutputStream.java
+++ b/./github_diff/CVE-2023-43642/newfiles/SnappyOutputStream.java
@@ -5,6 +5,7 @@ import org.xerial.snappy.buffer.CachedBufferAllocator;
 import java.io.IOException;
 import java.io.OutputStream;
 public class SnappyOutputStream extends OutputStream {
+    public static final int MAX_BLOCK_SIZE = 512 * 1024 * 1024; 
     static final int MIN_BLOCK_SIZE = 1 * 1024;
     static final int DEFAULT_BLOCK_SIZE = 32 * 1024; 
     protected final OutputStream out;
@@ -28,6 +29,10 @@ public class SnappyOutputStream extends OutputStream {
     public SnappyOutputStream(OutputStream out, int blockSize, BufferAllocatorFactory bufferAllocatorFactory) {
         this.out = out;
         this.blockSize = Math.max(MIN_BLOCK_SIZE, blockSize);
+        if (this.blockSize > MAX_BLOCK_SIZE){
+            throw new IllegalArgumentException(String.format("Provided chunk size %,d larger than max %,d", this.blockSize, MAX_BLOCK_SIZE));
+        }
+        
         int inputSize = blockSize;
         int outputSize = SnappyCodec.HEADER_SIZE + 4 + Snappy.maxCompressedLength(blockSize);
         this.inputBufferAllocator = bufferAllocatorFactory.getBufferAllocator(inputSize);
