diff --git a/./github_diff/CVE-2021-27807/oldfiles/RandomAccessBufferedFileInputStream.java b/./github_diff/CVE-2021-27807/newfiles/RandomAccessBufferedFileInputStream.java
index 3ff3480..a5e1417 100644
--- a/./github_diff/CVE-2021-27807/oldfiles/RandomAccessBufferedFileInputStream.java
+++ b/./github_diff/CVE-2021-27807/newfiles/RandomAccessBufferedFileInputStream.java
@@ -1,4 +1,5 @@
 package org.apache.pdfbox.io;
+import java.io.EOFException;
 import java.io.File;
 import java.io.FileOutputStream;
 import java.io.IOException;
@@ -220,13 +221,18 @@ public class RandomAccessBufferedFileInputStream extends InputStream implements
     
     @Override
     public byte[] readFully(int length) throws IOException {
-        byte[] b = new byte[length];
-        int bytesRead = read(b);
-        while(bytesRead < length) {
-            bytesRead += read(b, bytesRead, length-bytesRead);
+        byte[] bytes = new byte[length];
+        int bytesRead = 0;
+        do {
+            int count = read(bytes, bytesRead, length - bytesRead);
+            if (count < 0){
+                throw new EOFException();
             }
             
-        return b;
+            bytesRead += count;
+        }
+         while (bytesRead < length);
+        return bytes;
     }
     
     @Override
