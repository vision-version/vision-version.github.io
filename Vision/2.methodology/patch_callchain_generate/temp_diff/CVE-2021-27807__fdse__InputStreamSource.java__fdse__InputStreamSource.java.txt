diff --git a/./github_diff/CVE-2021-27807/oldfiles/InputStreamSource.java b/./github_diff/CVE-2021-27807/newfiles/InputStreamSource.java
index bf49ae9..f3c384f 100644
--- a/./github_diff/CVE-2021-27807/oldfiles/InputStreamSource.java
+++ b/./github_diff/CVE-2021-27807/newfiles/InputStreamSource.java
@@ -1,4 +1,5 @@
 package org.apache.pdfbox.pdfparser;
+import java.io.EOFException;
 import java.io.IOException;
 import java.io.InputStream;
 import java.io.PushbackInputStream;
@@ -81,21 +82,16 @@ final class InputStreamSource implements SequentialSource {
     @Override
     public byte[] readFully(int length) throws IOException {
         byte[] bytes = new byte[length];
-        int off = 0;
-        int len = length;
-        while (len > 0){
-            int n = this.read(bytes, off, len);
-            if (n > 0){
-                off += n;
-                len -= n;
+        int bytesRead = 0;
+        do {
+            int count = read(bytes, bytesRead, length - bytesRead);
+            if (count < 0){
+                throw new EOFException();
             }
             
-            else{
-                break;
+            bytesRead += count;
         }
-            
-        }
-        
+         while (bytesRead < length);
         return bytes;
     }
     
