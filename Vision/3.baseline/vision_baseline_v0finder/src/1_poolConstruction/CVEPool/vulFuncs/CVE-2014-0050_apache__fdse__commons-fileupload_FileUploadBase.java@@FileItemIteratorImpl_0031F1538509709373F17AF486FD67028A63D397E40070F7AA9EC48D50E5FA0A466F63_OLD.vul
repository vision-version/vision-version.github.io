if(ctx==null)thrownewnullpointerexception("ctxparameter");stringcontenttype=ctx.getcontenttype();if((null==contenttype)||(!contenttype.tolowercase(locale.english).startswith(multipart)))thrownewinvalidcontenttypeexception(format("therequestdoesn'tcontaina%sor%sstream,contenttypeheaderis%s",multipart_form_data,multipart_form_data,contenttype));inputstreaminput=ctx.getinputstream();@suppresswarnings("deprecation")finalintcontentlengthint=ctx.getcontentlength();finallongrequestsize=uploadcontext.class.isassignablefrom(ctx.getclass())?((uploadcontext)ctx).contentlength():contentlengthint;if(sizemax>=0)if(requestsize!=-1&&requestsize>sizemax)thrownewsizelimitexceededexception(format("therequestwasrejectedbecauseitssize(%s)exceedstheconfiguredmaximum(%s)",long.valueof(requestsize),long.valueof(sizemax)),requestsize,sizemax);input=newlimitedinputstream(input,sizemax)@overrideprotectedvoidraiseerror(longpsizemax,longpcount)throwsioexceptionfileuploadexceptionex=newsizelimitexceededexception(format("therequestwasrejectedbecauseitssize(%s)exceedstheconfiguredmaximum(%s)",long.valueof(pcount),long.valueof(psizemax)),pcount,psizemax);thrownewfileuploadioexception(ex);;stringcharencoding=headerencoding;if(charencoding==null)charencoding=ctx.getcharacterencoding();boundary=getboundary(contenttype);if(boundary==null)thrownewfileuploadexception("therequestwasrejectedbecausenomultipartboundarywasfound");notifier=newmultipartstream.progressnotifier(listener,requestsize);multi=newmultipartstream(input,boundary,notifier);multi.setheaderencoding(charencoding);skippreamble=true;findnextitem();