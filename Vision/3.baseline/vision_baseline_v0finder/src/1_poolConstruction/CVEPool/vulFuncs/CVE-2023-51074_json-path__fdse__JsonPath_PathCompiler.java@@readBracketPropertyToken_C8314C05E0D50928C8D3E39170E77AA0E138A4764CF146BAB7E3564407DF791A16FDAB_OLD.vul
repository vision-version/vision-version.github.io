if(!path.currentcharis(open_square_bracket))returnfalse;charpotentialstringdelimiter=path.nextsignificantchar();if(potentialstringdelimiter!=single_quote&&potentialstringdelimiter!=double_quote)returnfalse;list<string>properties=newarraylist<string>();intstartposition=path.position()+1;intreadposition=startposition;intendposition=0;booleaninproperty=false;booleaninescape=false;booleanlastsignificantwascomma=false;while(path.inbounds(readposition))charc=path.charat(readposition);if(inescape)inescape=false;elseif('\\'==c)inescape=true;elseif(c==close_square_bracket&&!inproperty)if(lastsignificantwascomma)fail("foundemptypropertyatindex"+readposition);break;elseif(c==potentialstringdelimiter)if(inproperty)charnextsignificantchar=path.nextsignificantchar(readposition);if(nextsignificantchar!=close_square_bracket&&nextsignificantchar!=comma)fail("propertymustbeseparatedbycommaorpropertymustbeterminatedclosesquarebracketatindex"+readposition);endposition=readposition;stringprop=path.subsequence(startposition,endposition).tostring();properties.add(utils.unescape(prop));inproperty=false;elsestartposition=readposition+1;inproperty=true;lastsignificantwascomma=false;elseif(c==comma&&!inproperty)if(lastsignificantwascomma)fail("foundemptypropertyatindex"+readposition);lastsignificantwascomma=true;readposition++;if(inproperty)fail("propertyhasnotbeenclosed-missingclosing"+potentialstringdelimiter);intendbracketindex=path.indexofnextsignificantchar(endposition,close_square_bracket)+1;path.setposition(endbracketindex);appender.appendpathtoken(pathtokenfactory.createpropertypathtoken(properties,potentialstringdelimiter));returnpath.currentistail()||readnexttoken(appender);