assert.notnull(input,"inputstringshouldnotbenull");intfirstquoteindex=input.indexof('\'');intsecondquoteindex=input.indexof('\'',firstquoteindex+1);if(firstquoteindex==-1||secondquoteindex==-1)returninput;charsetcharset=charset.forname(input.substring(0,firstquoteindex).trim());assert.istrue(utf_8.equals(charset)||iso_8859_1.equals(charset),"charsetshouldbeutf-8oriso-8859-1");byte[]value=input.substring(secondquoteindex+1,input.length()).getbytes(charset);bytearrayoutputstreambos=newbytearrayoutputstream();intindex=0;while(index<value.length)byteb=value[index];if(isrfc5987attrchar(b))bos.write((char)b);index++;elseif(b=='%')char[]array=(char)value[index+1],(char)value[index+2];bos.write(integer.parseint(string.valueof(array),16));index+=3;elsethrownewillegalargumentexception("invalidheaderfieldparameterformat(asdefinedinrfc5987)");returnnewstring(bos.tobytearray(),charset);