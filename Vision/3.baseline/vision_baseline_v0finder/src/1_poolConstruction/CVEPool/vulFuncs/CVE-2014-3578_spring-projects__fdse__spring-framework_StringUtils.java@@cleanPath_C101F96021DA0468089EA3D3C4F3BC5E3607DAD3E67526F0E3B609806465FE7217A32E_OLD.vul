if(path==null)returnnull;stringpathtouse=replace(path,windows_folder_separator,folder_separator);intprefixindex=pathtouse.indexof(":");stringprefix="";if(prefixindex!=-1)prefix=pathtouse.substring(0,prefixindex+1);pathtouse=pathtouse.substring(prefixindex+1);if(pathtouse.startswith(folder_separator))prefix=prefix+folder_separator;pathtouse=pathtouse.substring(1);string[]patharray=delimitedlisttostringarray(pathtouse,folder_separator);list<string>pathelements=newlinkedlist<string>();inttops=0;for(inti=patharray.length-1;i>=0;i--)stringelement=patharray[i];if(current_path.equals(element))elseif(top_path.equals(element))tops++;elseif(tops>0)tops--;elsepathelements.add(0,element);for(inti=0;i<tops;i++)pathelements.add(0,top_path);returnprefix+collectiontodelimitedstring(pathelements,folder_separator);