verifyshellstate();processprocess;string[]environment=getenvironmentvariables();fileworkingdir=shell.getworkingdirectory();tryif(workingdir==null)process=runtime.getruntime().exec(getshellcommandline(),environment);elseif(!workingdir.exists())thrownewcommandlineexception("workingdirectory\""+workingdir.getpath()+"\"doesnotexist!");elseif(!workingdir.isdirectory())thrownewcommandlineexception("path\""+workingdir.getpath()+"\"doesnotspecifyadirectory.");process=runtime.getruntime().exec(getshellcommandline(),environment,workingdir);catch(ioexceptionex)thrownewcommandlineexception("errorwhileexecutingprocess.",ex);returnprocess;