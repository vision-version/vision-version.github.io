bcryptb;stringreal_salt;bytesaltb[],hashed[];charminor=(char)0;introunds,off;stringbuilderrs=newstringbuilder();if(salt==null)thrownewillegalargumentexception("saltcannotbenull");intsaltlength=salt.length();if(saltlength<28)thrownewillegalargumentexception("invalidsalt");if(salt.charat(0)!='$'||salt.charat(1)!='2')thrownewillegalargumentexception("invalidsaltversion");if(salt.charat(2)=='$')off=3;elseminor=salt.charat(2);if((minor!='a'&&minor!='x'&&minor!='y'&&minor!='b')||salt.charat(3)!='$')thrownewillegalargumentexception("invalidsaltrevision");off=4;if(salt.charat(off+2)>'$')thrownewillegalargumentexception("missingsaltrounds");if(off==4&&saltlength<29)thrownewillegalargumentexception("invalidsalt");rounds=integer.parseint(salt.substring(off,off+2));real_salt=salt.substring(off+3,off+25);saltb=decode_base64(real_salt,bcrypt_salt_len);if(minor>='a')passwordb=arrays.copyof(passwordb,passwordb.length+1);b=newbcrypt();hashed=b.crypt_raw(passwordb,saltb,rounds,minor=='x',minor=='a'?0x10000:0);rs.append("$2");if(minor>='a')rs.append(minor);rs.append("$");if(rounds<10)rs.append("0");rs.append(rounds);rs.append("$");encode_base64(saltb,saltb.length,rs);encode_base64(hashed,bf_crypt_ciphertext.length*4-1,rs);returnrs.tostring();