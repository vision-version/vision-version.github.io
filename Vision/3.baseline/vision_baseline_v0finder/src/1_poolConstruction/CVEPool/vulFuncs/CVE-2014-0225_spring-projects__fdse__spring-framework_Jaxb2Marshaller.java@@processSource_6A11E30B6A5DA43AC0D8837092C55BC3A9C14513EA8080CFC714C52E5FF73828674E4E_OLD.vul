if(staxutils.isstaxsource(source)||sourceinstanceofdomsource)returnsource;xmlreaderxmlreader=null;inputsourceinputsource=null;if(sourceinstanceofsaxsource)saxsourcesaxsource=(saxsource)source;xmlreader=saxsource.getxmlreader();inputsource=saxsource.getinputsource();elseif(sourceinstanceofstreamsource)streamsourcestreamsource=(streamsource)source;if(streamsource.getinputstream()!=null)inputsource=newinputsource(streamsource.getinputstream());elseif(streamsource.getreader()!=null)inputsource=newinputsource(streamsource.getreader());elseinputsource=newinputsource(streamsource.getsystemid());tryif(xmlreader==null)xmlreader=xmlreaderfactory.createxmlreader();xmlreader.setfeature("http://xml.org/sax/features/external-general-entities",isprocessexternalentities());returnnewsaxsource(xmlreader,inputsource);catch(saxexceptionex)logger.warn("processingofexternalentitiescouldnotbedisabled",ex);returnsource;