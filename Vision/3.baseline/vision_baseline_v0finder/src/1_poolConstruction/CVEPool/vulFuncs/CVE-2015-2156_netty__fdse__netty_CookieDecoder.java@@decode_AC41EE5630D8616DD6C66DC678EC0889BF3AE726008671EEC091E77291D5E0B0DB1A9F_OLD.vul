list<string>names=newarraylist<string>(8);list<string>values=newarraylist<string>(8);extractkeyvaluepairs(header,names,values);if(names.isempty())returncollections.emptyset();inti;intversion=0;if(names.get(0).equalsignorecase(version))tryversion=integer.parseint(values.get(0));catch(numberformatexceptione)i=1;elsei=0;if(names.size()<=i)returncollections.emptyset();set<cookie>cookies=newtreeset<cookie>();for(;i<names.size();i++)stringname=names.get(i);stringvalue=values.get(i);if(value==null)value="";cookiec=initcookie(name,value);if(c==null)break;booleandiscard=false;booleansecure=false;booleanhttponly=false;stringcomment=null;stringcommenturl=null;stringdomain=null;stringpath=null;longmaxage=long.min_value;list<integer>ports=newarraylist<integer>(2);for(intj=i+1;j<names.size();j++,i++)name=names.get(j);value=values.get(j);if(discard.equalsignorecase(name))discard=true;elseif(cookieheadernames.secure.equalsignorecase(name))secure=true;elseif(cookieheadernames.httponly.equalsignorecase(name))httponly=true;elseif(comment.equalsignorecase(name))comment=value;elseif(commenturl.equalsignorecase(name))commenturl=value;elseif(cookieheadernames.domain.equalsignorecase(name))domain=value;elseif(cookieheadernames.path.equalsignorecase(name))path=value;elseif(cookieheadernames.expires.equalsignorecase(name))trylongmaxagemillis=httpheaderdateformat.get().parse(value).gettime()-system.currenttimemillis();maxage=maxagemillis/1000+(maxagemillis%1000!=0?1:0);catch(parseexceptione)elseif(cookieheadernames.max_age.equalsignorecase(name))maxage=integer.parseint(value);elseif(version.equalsignorecase(name))version=integer.parseint(value);elseif(port.equalsignorecase(name))string[]portlist=stringutil.split(value,comma);for(strings1:portlist)tryports.add(integer.valueof(s1));catch(numberformatexceptione)elsebreak;c.setversion(version);c.setmaxage(maxage);c.setpath(path);c.setdomain(domain);c.setsecure(secure);c.sethttponly(httponly);if(version>0)c.setcomment(comment);if(version>1)c.setcommenturl(commenturl);c.setports(ports);c.setdiscard(discard);cookies.add(c);returncookies;