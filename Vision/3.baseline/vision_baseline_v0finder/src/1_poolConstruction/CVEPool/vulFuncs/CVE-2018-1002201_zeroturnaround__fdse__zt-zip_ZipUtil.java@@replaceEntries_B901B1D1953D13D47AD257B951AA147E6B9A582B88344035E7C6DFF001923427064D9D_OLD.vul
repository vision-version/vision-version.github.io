if(log.isdebugenabled())log.debug("copying'"+zip+"'to'"+destzip+"'andreplacingentries"+arrays.aslist(entries)+".");finalmap<string,zipentrysource>entrybypath=entriesbypath(entries);finalintentrycount=entrybypath.size();tryfinalzipoutputstreamout=newzipoutputstream(newbufferedoutputstream(newfileoutputstream(destzip)));tryfinalset<string>names=newhashset<string>();iterate(zip,newzipentrycallback()publicvoidprocess(inputstreamin,zipentryzipentry)throwsioexceptionif(names.add(zipentry.getname()))zipentrysourceentry=(zipentrysource)entrybypath.remove(zipentry.getname());if(entry!=null)addentry(entry,out);elsezipentryutil.copyentry(zipentry,in,out);elseif(log.isdebugenabled())log.debug("duplicateentry:",zipentry.getname()););finallyioutils.closequietly(out);catch(ioexceptione)zipexceptionutil.rethrow(e);returnentrybypath.size()<entrycount;