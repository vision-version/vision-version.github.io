if(log.isdebugenabled())log.debug("copying'"+zip+"'to'"+destzip+"'andadding/replacingentries"+arrays.aslist(entries)+".");finalmap<string,zipentrysource>entrybypath=entriesbypath(entries);tryfinalzipoutputstreamout=newzipoutputstream(newbufferedoutputstream(newfileoutputstream(destzip)));tryfinalset<string>names=newhashset<string>();iterate(zip,newzipentrycallback()publicvoidprocess(inputstreamin,zipentryzipentry)throwsioexceptionif(names.add(zipentry.getname()))zipentrysourceentry=(zipentrysource)entrybypath.remove(zipentry.getname());if(entry!=null)addentry(entry,out);elsezipentryutil.copyentry(zipentry,in,out);elseif(log.isdebugenabled())log.debug("duplicateentry:",zipentry.getname()););for(zipentrysourcezipentrysource:entrybypath.values())addentry(zipentrysource,out);finallyioutils.closequietly(out);catch(ioexceptione)zipexceptionutil.rethrow(e);