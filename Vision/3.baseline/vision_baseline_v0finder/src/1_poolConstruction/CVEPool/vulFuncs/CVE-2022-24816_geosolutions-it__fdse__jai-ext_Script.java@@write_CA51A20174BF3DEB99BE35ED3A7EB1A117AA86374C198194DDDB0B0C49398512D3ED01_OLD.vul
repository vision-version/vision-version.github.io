stringpackagename="it.geosolutions.jaiext.jiffle.runtime";w.line("package"+packagename+";");w.newline();w.line("importjava.util.list;");w.line("importjava.util.arraylist;");w.line("importjava.util.arrays;");w.newline();stringscript=w.getscript();if(script!=null)string[]lines=script.split("\n");w.line("/**");w.line("*javaruntimeclassgeneratedfromthefollowingjifflescript:");w.line("*<code>");for(stringline:lines)w.append("*").append(line).newline();w.line("*</code>");w.line("*/");stringtemplate="publicclass%sextends%s";stringclassname;jiffle.runtimemodelmodel=w.getruntimemodel();if(model==jiffle.runtimemodel.direct)classname="jiffledirectruntimeimpl";elseclassname="jiffleindirectruntimeimpl";w.line(format(template,classname,w.getbaseclassname()));w.inc();if(w.isinternalbaseclass())for(stringsourceimage:sourceimages)w.indent().append("sourceimages_").append(sourceimage).append(";").newline();if(model==jiffle.runtimemodel.direct)for(stringdestimage:destimages)w.indent().append("destinationimaged_").append(destimage).append(";").newline();globals.writefields(w);w.newline();w.indent().append("public").append(classname).append("()").newline();w.inc();w.indent().append("super(newstring[]");globals.listnames(w);w.append(");").newline();w.dec();w.line("");w.newline();if(options!=null&&!options.isempty())w.line("protectedvoidinitoptionvars()");w.inc();for(map.entry<string,string>entry:options.entryset())stringname=entry.getkey();stringvalue=entry.getvalue();trystringactiveexpr=optionlookup.getactiveruntimexpr(name,value);w.line(activeexpr);catch(undefinedoptionexceptione)thrownewjiffleparserexception(e);w.dec();w.line("");w.line("protectedvoidinitimagescopevars()");w.inc();if(w.isinternalbaseclass())for(stringsourceimage:sourceimages)w.indent().append("s_").append(sourceimage).append("=(sourceimage)_images.get(\"").append(sourceimage).append("\");").newline();if(model==jiffle.runtimemodel.direct)for(stringdestimage:destimages)w.indent().append("d_").append(destimage).append("=(destinationimage)_destimages.get(\"").append(destimage).append("\");").newline();globals.write(w);w.line("_imagescopevarsinitialized=true;");w.dec();w.line("");w.newline();if(model==jiffle.runtimemodel.direct)w.line("publicvoidevaluate(double_x,double_y)");elsew.line("publicvoidevaluate(double_x,double_y,double[]result)");w.inc();w.line("if(!isworldset())");w.inc();w.line("setdefaultbounds();");w.dec();w.line("");w.line("if(!_imagescopevarsinitialized)");w.inc();w.line("initimagescopevars();");w.dec();w.line("");w.line("_stk.clear();");readoptimizer.declarerepeatedreads(w);w.newline();stmts.write(w);w.dec();w.line("");w.dec();w.line("");