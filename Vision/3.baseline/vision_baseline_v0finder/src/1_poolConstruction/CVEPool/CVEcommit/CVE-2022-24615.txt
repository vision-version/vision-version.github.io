PACK:./clones/srikanth-lingala__split__zip4j
commit 35122fd19b3f1fae531d9e20d54e8dc894414dab
Author: Srikanth Reddy Lingala <srikanth.mailbox@gmail.com>
Date:   Sun Mar 13 07:39:45 2022 -0400

    #373 Fill NPE when aesKeyStrength is null

diff --git a/src/main/java/net/lingala/zip4j/io/inputstream/AesCipherInputStream.java b/src/main/java/net/lingala/zip4j/io/inputstream/AesCipherInputStream.java
index a3cb2ef..066980e 100644
--- a/src/main/java/net/lingala/zip4j/io/inputstream/AesCipherInputStream.java
+++ b/src/main/java/net/lingala/zip4j/io/inputstream/AesCipherInputStream.java
@@ -158,6 +158,11 @@ class AesCipherInputStream extends CipherInputStream<AESDecrypter> {
     }
 
     AESExtraDataRecord aesExtraDataRecord = localFileHeader.getAesExtraDataRecord();
+
+    if (aesExtraDataRecord.getAesKeyStrength() == null) {
+      throw new IOException("Invalid aes key strength in aes extra data record");
+    }
+
     byte[] saltBytes = new byte[aesExtraDataRecord.getAesKeyStrength().getSaltLength()];
     readRaw(saltBytes);
     return saltBytes;
diff --git a/src/test/java/net/lingala/zip4j/io/inputstream/ZipInputStreamIT.java b/src/test/java/net/lingala/zip4j/io/inputstream/ZipInputStreamIT.java
index 939f3a8..730efee 100644
--- a/src/test/java/net/lingala/zip4j/io/inputstream/ZipInputStreamIT.java
+++ b/src/test/java/net/lingala/zip4j/io/inputstream/ZipInputStreamIT.java
@@ -301,6 +301,15 @@ public class ZipInputStreamIT extends AbstractIT {
         null, InternalZipConstants.BUFF_SIZE, false, 2);
   }
 
+  @Test
+  public void testExtractZipFileWithNullAesExtraDataRecordThrowsException() throws IOException {
+    expectedException.expect(IOException.class);
+    expectedException.expectMessage("Invalid aes key strength in aes extra data record");
+
+    extractZipFileWithInputStreams(TestUtils.getTestArchiveFromResources("null-aes-key-strength-in-aes-extra-data-record"),
+        null, InternalZipConstants.BUFF_SIZE, false, 1);
+  }
+
   private void extractZipFileWithInputStreams(File zipFile, char[] password) throws IOException {
     extractZipFileWithInputStreams(zipFile, password, InternalZipConstants.BUFF_SIZE);
   }
diff --git a/src/test/resources/test-archives/null-aes-key-strength-in-aes-extra-data-record b/src/test/resources/test-archives/null-aes-key-strength-in-aes-extra-data-record
new file mode 100644
index 0000000..8bfa888
Binary files /dev/null and b/src/test/resources/test-archives/null-aes-key-strength-in-aes-extra-data-record differ
