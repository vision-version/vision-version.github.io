            final BitSet allowedChars = isPath ? ALLOWED_PATH_CHARS : ALLOWED_QUERY_CHARS;
            if (allowedChars.get(cp)) {
            } else {
                buf.addEncoded((byte) cp);
            }
